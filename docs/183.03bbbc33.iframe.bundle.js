"use strict";(self.webpackChunkcomponents_angular=self.webpackChunkcomponents_angular||[]).push([[183],{"./src/directives/ball-parabola.directive.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>BallParabolaDirective});var tslib__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@angular/common/fesm2022/dom_tokens-rA0ACyx7.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),rxjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),rxjs_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");let BallParabolaDirective=class BallParabolaDirective{elementRef;document;isAnimationEnabled=!1;targetDomId;finishParabola=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter;clickSubscription=null;BALL_STYLES={initial:{width:"14px",height:"14px",borderRadius:"7px",backgroundColor:"red",position:"absolute",transition:"left 1s, top 1s"},final:{width:"6px",height:"6px",borderRadius:"3px",transition:"left 1s ease-in, top 0.6s linear, width 0.7s linear, height 0.7s linear, borderRadius 0.7s linear"}};ANIMATION_TIMING={initialDelay:20,duration:1500};constructor(elementRef,document){this.elementRef=elementRef,this.document=document}ngAfterViewInit(){this.updateClickSubscription()}ngOnDestroy(){this.unsubscribeClick()}updateClickSubscription(){this.unsubscribeClick(),this.isAnimationEnabled&&(this.clickSubscription=(0,rxjs__WEBPACK_IMPORTED_MODULE_1__.R)(this.elementRef.nativeElement,"click").pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.F)()).subscribe((event=>{this.createParabolaBall(event)})))}unsubscribeClick(){this.clickSubscription&&(this.clickSubscription.unsubscribe(),this.clickSubscription=null)}createParabolaBall(event){const ball=this.createBallElement(),targetElement=this.document.getElementById(this.targetDomId);targetElement?(this.positionBall(ball),this.animateBall(ball,targetElement)):console.warn(`Target element with id "${this.targetDomId}" not found`)}createBallElement(){const ball=this.document.createElement("div");return ball.className="parabola-ball",Object.assign(ball.style,this.BALL_STYLES.initial),this.document.body.appendChild(ball),ball}positionBall(ball){const originRect=this.elementRef.nativeElement.getBoundingClientRect();ball.style.top=`${originRect.top}px`,ball.style.left=`${originRect.left+originRect.width/2}px`}animateBall(ball,targetElement){const targetRect=targetElement.getBoundingClientRect();setTimeout((()=>{Object.assign(ball.style,this.BALL_STYLES.final),ball.style.top=targetRect.top-2+"px",ball.style.left=targetRect.left+targetRect.width-3+"px"}),this.ANIMATION_TIMING.initialDelay),setTimeout((()=>{this.document.body.contains(ball)&&this.document.body.removeChild(ball),this.finishParabola.emit()}),this.ANIMATION_TIMING.duration)}static ctorParameters=()=>[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef},{type:Document,decorators:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Optional},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Inject,args:[_angular_common__WEBPACK_IMPORTED_MODULE_3__.q]}]}];static propDecorators={isAnimationEnabled:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input}],targetDomId:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Input}],finishParabola:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Output}]}};BallParabolaDirective=(0,tslib__WEBPACK_IMPORTED_MODULE_4__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive)({selector:"[appBallParabola]"})],BallParabolaDirective)},"./src/directives/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{TK:()=>IntersectionObserverDirective,d:()=>MutationObserverDirective,fd:()=>PollingDirective,xo:()=>ScrollDirective,ne:()=>TraceHighlightDirective,mH:()=>WaterMarkDirective});var tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js");let DestroySubscription=class DestroySubscription{destroy$=new Subject.B;ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};DestroySubscription=(0,tslib_es6.Cg)([(0,core.Directive)()],DestroySubscription);var takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js");let EventSourceService=class EventSourceService{zone;xs;constructor(zone){this.zone=zone}connectToServerSentEvents(url,options){return this.xs=this.XhrSource(url,options),new Observable.c((subscriber=>{this.xs.addEventListener("error",(error=>{this.zone.run((()=>subscriber.error(JSON.parse(error.reason))))})),this.xs.addEventListener("message",(e=>{const message=JSON.parse(e.data);this.zone.run((()=>subscriber.next(message)))})),this.xs.addEventListener("close",(e=>{this.zone.run((()=>subscriber.complete()))}))}))}close(){this.xs&&(this.xs.close(),this.xs=null)}XhrSource(url,opts){const eventTarget=new EventTarget,xhr=new XMLHttpRequest;for(var k in xhr.open(opts.method||"GET",url,!0),opts.headers)xhr.setRequestHeader(k,opts.headers[k]);var ongoing=!1,start=0;return xhr.onprogress=()=>{if(!ongoing){ongoing=!0;const option={status:xhr.status,headers:xhr.getAllResponseHeaders(),url:xhr.responseUrl};eventTarget.dispatchEvent(new Event("open",option))}for(var i,chunk;(i=xhr.responseText.indexOf("\n\n",start))>=0;)chunk=xhr.responseText.slice(start,i),start=i+2,chunk.length&&eventTarget.dispatchEvent(this._sseevent(chunk))},xhr.onloadend=_=>{200==xhr.status?eventTarget.dispatchEvent(new CloseEvent("close")):eventTarget.dispatchEvent(new CloseEvent("error",{reason:xhr.response}))},xhr.timeout=opts.timeout,xhr.ontimeout=_=>{eventTarget.dispatchEvent(new CloseEvent("error",{reason:JSON.stringify({message:"Network request timed out"})}))},xhr.onerror=_=>{eventTarget.dispatchEvent(new CloseEvent("error",{reason:xhr.response}))},xhr.onabort=_=>{eventTarget.dispatchEvent(new CloseEvent("error",{reason:JSON.stringify({message:"Network request aborted"})}))},eventTarget.close=()=>{xhr.abort()},xhr.send(opts.body),eventTarget}_sseevent(message){let type="message",start=0;message.startsWith("event: ")&&(start=message.indexOf("\n"),type=message.slice(7,start)),start=message.indexOf(": ",start)+2;let data=message.slice(start,message.length);return new MessageEvent(type,{data})}static ctorParameters=()=>[{type:core.NgZone}]};EventSourceService=(0,tslib_es6.Cg)([(0,core.Injectable)({providedIn:"root"})],EventSourceService);var lodash=__webpack_require__("./node_modules/lodash/lodash.js");const StreamStatusIconMap={default:["loading","status-icon loading"],failed:["question-circle","status-icon error"],succeeded:["check-circle","status-icon success"],start:["icons:node-start","node-icon start"],llm:["icons:node-llm","node-icon llm"],"if-else":["icons:node-branch","node-icon if-else"],"http-request":["icons:node-http","node-icon http-request"],code:["icons:script","node-icon code"],tool:["icons:node-iteration","node-icon iteration"],iteration:["icons:node-iteration","node-icon iteration"],answer:["icons:node-answer","node-icon answer"]};var StreamEvent;!function(StreamEvent){StreamEvent.PING="ping",StreamEvent.ERROR="error",StreamEvent.MESSAGE="message",StreamEvent.MESSAGE_END="message_end",StreamEvent.TTS_MESSAGE="tts_message",StreamEvent.TTS_MESSAGE_END="tts_message_end",StreamEvent.MESSAGE_FILE="message_file",StreamEvent.MESSAGE_REPLACE="message_replace",StreamEvent.AGENT_THOUGHT="agent_thought",StreamEvent.AGENT_MESSAGE="agent_message",StreamEvent.WORKFLOW_STARTED="workflow_started",StreamEvent.WORKFLOW_FINISHED="workflow_finished",StreamEvent.NODE_STARTED="node_started",StreamEvent.NODE_FINISHED="node_finished",StreamEvent.NODE_RETRY="node_retry",StreamEvent.PARALLEL_BRANCH_STARTED="parallel_branch_started",StreamEvent.PARALLEL_BRANCH_FINISHED="parallel_branch_finished",StreamEvent.ITERATION_STARTED="iteration_started",StreamEvent.ITERATION_NEXT="iteration_next",StreamEvent.ITERATION_COMPLETED="iteration_completed",StreamEvent.LOOP_STARTED="loop_started",StreamEvent.LOOP_NEXT="loop_next",StreamEvent.LOOP_COMPLETED="loop_completed",StreamEvent.TEXT_CHUNK="text_chunk",StreamEvent.TEXT_REPLACE="text_replace",StreamEvent.AGENT_LOG="agent_log"}(StreamEvent||(StreamEvent={}));let EventSourceDirective=class EventSourceDirective extends DestroySubscription{_eventSourceService;constructor(_eventSourceService){super(),this._eventSourceService=_eventSourceService}chat(request,chatContext){chatContext.messages.push((0,lodash.cloneDeep)(request.body));(0,lodash.last)(chatContext.messages).answerLoading=!0,this._eventSourceService.connectToServerSentEvents(request.url,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer token"},body:JSON.stringify(request.body),withCredentials:!0}).pipe((0,takeUntil.Q)(this.destroy$)).subscribe({next:data=>this._handleEvent(data,chatContext),error:error=>this._handleError(error,chatContext)})}_handleEvent(message,chatContext){const currentMessage=(0,lodash.last)(chatContext.messages),{event,message_id,conversation_id,task_id,workflow_run_id,answer="",thought,code,data}=message;switch(chatContext.currentConversation&&(chatContext.currentConversation.id=conversation_id),currentMessage.id=message_id,data&&function formatSreamMeta(stream){stream.status=stream.status||"default";const[icon,className]=StreamStatusIconMap[stream.status];if(stream.status_icon=icon,stream.status_className=className,stream.node_type){const[node_icon,node_className]=StreamStatusIconMap[stream.node_type]||["",""];stream.node_icon=node_icon,stream.node_className=node_className}}(data),event){case StreamEvent.WORKFLOW_STARTED:chatContext.messageMap.set(message_id,{workflow:data,nodeMap:new Map});break;case StreamEvent.NODE_STARTED:case StreamEvent.NODE_FINISHED:chatContext.messageMap.get(message_id).nodeMap.set(data.node_id,data);break;case StreamEvent.AGENT_THOUGHT:currentMessage.thought=thought,thought&&(currentMessage.answerLoading=!1);break;case StreamEvent.AGENT_MESSAGE:case StreamEvent.MESSAGE:currentMessage.answer=currentMessage.answer+answer,this._replaceInput(currentMessage);break;case StreamEvent.WORKFLOW_FINISHED:currentMessage.answer=data.outputs?.answer||"",currentMessage.answerLoading=!1;break;case StreamEvent.MESSAGE_END:currentMessage.answerLoading=!1;break;case StreamEvent.ERROR:currentMessage.answer+=code||"抱歉，服务器异常",currentMessage.answerLoading=!1}}_handleError(error,chatContext){const currentMessage=(0,lodash.last)(chatContext.messages);currentMessage.answer=error?.message||"抱歉，服务器异常",currentMessage.answerLoading=!1}_replaceInput(message){if(message?.answer){const inputs=message.inputs||{};let answer=message.answer;Object.keys(inputs).forEach((key=>{const regex=new RegExp(`{{${key}}}`,"g");answer=answer.replace(regex,inputs[key])})),message.answer=answer}}static ctorParameters=()=>[{type:EventSourceService}]};EventSourceDirective=(0,tslib_es6.Cg)([(0,core.Directive)()],EventSourceDirective);let IntersectionObserverDirective=class IntersectionObserverDirective{elementRef;visible=new core.EventEmitter;intersectionObserver;constructor(elementRef){this.elementRef=elementRef;this.intersectionObserver=new IntersectionObserver((entries=>{entries.forEach((({intersectionRatio})=>{intersectionRatio>0&&this.visible.emit()}))}),{threshold:.1})}ngAfterViewInit(){this.intersectionObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.intersectionObserver.disconnect()}static ctorParameters=()=>[{type:core.ElementRef}];static propDecorators={visible:[{type:core.Output}]}};IntersectionObserverDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[appIntersectionObserver]"})],IntersectionObserverDirective);let MutationObserverDirective=class MutationObserverDirective{elementRef;mutationChange=new core.EventEmitter;mutationObserver;config={attributes:!0,childList:!0,subtree:!1};constructor(elementRef){this.elementRef=elementRef;this.mutationObserver=new MutationObserver((mutationList=>{for(const mutation of mutationList)"attributes"!==mutation.type&&"childList"!==mutation.type||this.mutationChange.emit(mutation)}))}ngAfterViewInit(){this.mutationObserver.observe(this.elementRef.nativeElement,this.config)}ngOnDestroy(){this.mutationObserver.disconnect()}static ctorParameters=()=>[{type:core.ElementRef}];static propDecorators={mutationChange:[{type:core.Output}]}};MutationObserverDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[appMutationObserver]"})],MutationObserverDirective);var timer=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/timer.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),lift=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/lift.js"),OperatorSubscriber=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),identity=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/identity.js"),innerFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js");var catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js"),takeWhile=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeWhile.js");let PollingDirective=class PollingDirective{interval=2e3;polling$;subscription;_isPolling=!1;ngOnDestroy(){this._stopPolling()}polling(source,minRetry,condition){if(this._isPolling)throw new Error("Polling is already in progress");this._isPolling=!0,this.polling$=(0,timer.O)(0,this.interval).pipe((0,switchMap.n)((()=>source.pipe(function retry(configOrCount){var config;void 0===configOrCount&&(configOrCount=1/0);var _a=(config=configOrCount&&"object"==typeof configOrCount?configOrCount:{count:configOrCount}).count,count=void 0===_a?1/0:_a,delay=config.delay,_b=config.resetOnSuccess,resetOnSuccess=void 0!==_b&&_b;return count<=0?identity.D:(0,lift.N)((function(source,subscriber){var innerSub,soFar=0,subscribeForRetry=function(){var syncUnsub=!1;innerSub=source.subscribe((0,OperatorSubscriber._)(subscriber,(function(value){resetOnSuccess&&(soFar=0),subscriber.next(value)}),void 0,(function(err){if(soFar++<count){var resub_1=function(){innerSub?(innerSub.unsubscribe(),innerSub=null,subscribeForRetry()):syncUnsub=!0};if(null!=delay){var notifier="number"==typeof delay?(0,timer.O)(delay):(0,innerFrom.Tg)(delay(err,soFar)),notifierSubscriber_1=(0,OperatorSubscriber._)(subscriber,(function(){notifierSubscriber_1.unsubscribe(),resub_1()}),(function(){subscriber.complete()}));notifier.subscribe(notifierSubscriber_1)}else resub_1()}else subscriber.error(err)}))),syncUnsub&&(innerSub.unsubscribe(),innerSub=null,subscribeForRetry())};subscribeForRetry()}))}(minRetry),(0,catchError.W)((error=>(this.pollingError(error),empty.w)))))),(0,takeWhile.v)((response=>this._isPolling&&condition(response)),!0))}listenPolling(){if(!this.polling$)throw new Error("Polling is not set up. Call polling() first.");this.subscription=this.polling$.subscribe({next:response=>this.pollingNext(response),error:err=>this.pollingError(err),complete:()=>this.pollingComplete()})}pollingNext(response){console.log("Polling response:",response)}pollingError(err){console.error("Polling error:",err),this._stopPolling()}pollingComplete(){console.log("Polling completed"),this._isPolling=!1}_stopPolling(){this._isPolling=!1,this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)}static propDecorators={interval:[{type:core.Input}]}};PollingDirective=(0,tslib_es6.Cg)([(0,core.Directive)()],PollingDirective);let ScrollDirective=class ScrollDirective{elementRef;scrollToTop=new core.EventEmitter;scrollToBottom=new core.EventEmitter;threshold=50;constructor(elementRef){this.elementRef=elementRef}onScroll(event){const element=event.target,scrollTop=element.scrollTop;element.scrollHeight-scrollTop-element.clientHeight<this.threshold&&this.scrollToBottom.emit(),scrollTop<this.threshold&&this.scrollToTop.emit()}static ctorParameters=()=>[{type:core.ElementRef}];static propDecorators={scrollToTop:[{type:core.Output}],scrollToBottom:[{type:core.Output}],onScroll:[{type:core.HostListener,args:["scroll",["$event"]]}]}};ScrollDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[appScroll]"})],ScrollDirective);var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),format=__webpack_require__("./node_modules/date-fns/esm/format/index.js");let WaterMarkDirective=class WaterMarkDirective{el;renderer;name;isDisplay;positionStyle="relative";constructor(el,renderer){this.el=el,this.renderer=renderer}ngAfterViewInit(){var _this=this;return(0,asyncToGenerator.A)((function*(){if(!_this.name||!_this.isDisplay)return;const waterMarkDiv=_this.renderer.createElement("div"),waterMarkDivStyle=`\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      opacity: 0.13;\n      z-index: 1005;\n      background-image: url('${_this.getWaterMarkImageUrl()}');\n    `;_this.renderer.setAttribute(waterMarkDiv,"style",waterMarkDivStyle),_this.renderer.appendChild(_this.el.nativeElement,waterMarkDiv)}))()}getWaterMarkImageUrl(){const canvas=this.renderer.createElement("canvas");canvas.setAttribute("width","250px"),canvas.setAttribute("height","150px");const ctx=canvas.getContext("2d");ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="12px PingFangSC-Regular, PingFang SC",ctx.fillStyle="#54627B",ctx.rotate(10*Math.PI/180);return[`${this.name} ${(0,format.A)(new Date,"yyyy-MM-dd HH:mm:ss")}`].forEach(((str,i)=>{ctx.fillText(str,40,70+15*i)})),canvas.toDataURL()}static ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2}];static propDecorators={name:[{type:core.Input}],isDisplay:[{type:core.Input}],positionStyle:[{type:core.HostBinding,args:["style.position"]}]}};WaterMarkDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[appWaterMark]"})],WaterMarkDirective);__webpack_require__("./src/directives/ball-parabola.directive.ts");var filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js");let TraceHighlightDirective=class TraceHighlightDirective{elRef;render;highlightConf;highlightId;hightTraceIdSetChange=new core.EventEmitter;wrapperPos="relative";hightTraceIdSet=new Set;destroy$=new Subject.B;HIGHLIGHT_STYLES={normal:{background:"rgba(255, 242, 123, 0.3)",border:"1.5px dashed #FD8701"},active:{background:"rgba(7, 181, 249, 0.3)",border:"none"}};constructor(elRef,render){this.elRef=elRef,this.render=render}ngOnChanges(changes){if(changes.highlightId&&this.highlightId){const element=document.getElementById(this.highlightId);if(!element)return;this.activeAndScrollToCurPoint(element)}}ngOnInit(){this.highlightConf?.isDisabled||this.highlightConf.onHighlight$.pipe((0,takeUntil.Q)(this.destroy$),(0,filter.p)((value=>!1!==value))).subscribe((value=>{this.clearAllHighlights(),value.forEach((point=>this.handleTracePoint(point))),this.hightTraceIdSetChange.emit(this.hightTraceIdSet)}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}handleTracePoint(tracePoint){setTimeout((()=>{const{isShadowDom,shadowDomElement}=this.highlightConf,walkerWrapper=isShadowDom?shadowDomElement:this.elRef.nativeElement;if(!walkerWrapper)return;const{keyword,fieldName}=tracePoint,regxStr=keyword?.replace(/([*+?$^.|\\\)\(])/g,"\\$1"),matchRegx=new RegExp(`${regxStr}`,"g");this.searchMatchTextNode(walkerWrapper,matchRegx)}))}searchMatchTextNode(elementNode,matchRegx){const textNodeWalker=document.createTreeWalker(elementNode,NodeFilter.SHOW_TEXT,(node=>node.nodeValue?.match(matchRegx)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP));let curMatchTextNode=textNodeWalker.nextNode();for(;curMatchTextNode;)this.searchMatchTextStr(curMatchTextNode,matchRegx),curMatchTextNode=textNodeWalker.nextNode()}searchMatchTextStr(textNode,matchRegx){const textNodeStr=textNode.textContent;let matchResult=matchRegx.exec(textNodeStr||"");for(;matchResult;){const startIndex=matchResult?.index,endIndex=matchRegx?.lastIndex;this.highlightTextRange(textNode,startIndex,endIndex),matchResult=matchRegx.exec(textNodeStr||"")}}highlightTextRange(textNode,startIndex,endIndex){try{const range=this.createRange(textNode,startIndex,endIndex),rects=this.getHighlightRects(range,textNode),highlightElement=this.createHighlightElement(rects);this.elRef.nativeElement.appendChild(highlightElement)}catch(err){console.error(`${textNode}, 溯源文本高亮失败，错误信息：${err}`)}}createRange(textNode,startIndex,endIndex){const range=document.createRange();return range.setStart(textNode,startIndex),range.setEnd(textNode,endIndex),range}getHighlightRects(range,textNode){const clientRect=range.getBoundingClientRect();return{clientRect,elementClientRect:textNode.parentElement?.getBoundingClientRect()||clientRect,wrapperClientRect:this.elRef.nativeElement.getBoundingClientRect()}}createHighlightElement(rects){const fragment=document.createDocumentFragment(),highLightElement=this.render.createElement("div");return fragment.appendChild(highLightElement),requestAnimationFrame((()=>{const{clientRect,elementClientRect,wrapperClientRect}=rects,highLightStyle=highLightElement.style;highLightElement.id=this.generateHighlightId(),this.hightTraceIdSet.add(highLightElement.id),highLightElement.className="highlight-mask";const{left,top,width,height}=clientRect,{width:parentWidth,left:parentLeft,right:parentRight}=elementClientRect,{left:wrapperLeft,top:wrapperTop}=wrapperClientRect,isOverflow=left>parentRight,highLightLeft=isOverflow?parentLeft-wrapperLeft:left-wrapperLeft,highLightWidth=isOverflow?parentWidth:width,highLightTop=top-wrapperTop;Object.assign(highLightStyle,{position:"absolute",left:`${highLightLeft}px`,top:`${highLightTop}px`,width:`${highLightWidth}px`,height:`${height}px`,maxWidth:parentWidth-(highLightLeft-(parentLeft-wrapperLeft))+"px",pointerEvents:"none",lineHeight:`${height}px`,...this.HIGHLIGHT_STYLES.normal}),this.elRef.nativeElement.appendChild(fragment)})),highLightElement}generateHighlightId(){return`hl-${performance.now().toString(36)}`}activeAndScrollToCurPoint(curActiveElement){curActiveElement&&requestAnimationFrame((()=>{Array.from(document.querySelectorAll(".highlight-mask")).forEach((element=>{Object.assign(element.style,this.HIGHLIGHT_STYLES.normal)})),curActiveElement.scrollIntoView({behavior:"smooth",block:"center"}),Object.assign(curActiveElement.style,this.HIGHLIGHT_STYLES.active)}))}clearAllHighlights(){requestAnimationFrame((()=>{const highlightElements=this.elRef.nativeElement.querySelectorAll(".highlight-mask"),fragment=document.createDocumentFragment();highlightElements.forEach((element=>{fragment.appendChild(element)})),this.hightTraceIdSet.clear()}))}static ctorParameters=()=>[{type:core.ElementRef},{type:core.Renderer2}];static propDecorators={highlightConf:[{type:core.Input,args:["traceHighlight"]}],highlightId:[{type:core.Input}],hightTraceIdSetChange:[{type:core.Output}],wrapperPos:[{type:core.HostBinding,args:["style.position"]}]}};TraceHighlightDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[traceHighlight]"})],TraceHighlightDirective)}}]);